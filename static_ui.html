<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>2048</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #faf8ef; display: flex; justify-content: center; align-items: center; min-height: 100vh; touch-action: none; }
        .container { text-align: center; }
        h1 { color: #776e65; font-size: 48px; margin-bottom: 10px; }
        .score { color: #776e65; font-size: 24px; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(4, 80px); gap: 10px; background: #bbada0; padding: 10px; border-radius: 6px; }
        .tile { width: 80px; height: 80px; display: flex; justify-content: center; align-items: center; font-size: 28px; font-weight: bold; border-radius: 4px; }
        .t0 { background: #cdc1b4; }
        .t2 { background: #eee4da; color: #776e65; }
        .t4 { background: #ede0c8; color: #776e65; }
        .t8 { background: #f2b179; color: #f9f6f2; }
        .t16 { background: #f59563; color: #f9f6f2; }
        .t32 { background: #f67c5f; color: #f9f6f2; }
        .t64 { background: #f65e3b; color: #f9f6f2; }
        .t128 { background: #edcf72; color: #f9f6f2; }
        .t256 { background: #edcc61; color: #f9f6f2; }
        .t512 { background: #edc850; color: #f9f6f2; }
        .t1024 { background: #edc53f; color: #f9f6f2; font-size: 22px; }
        .t2048 { background: #edc22e; color: #f9f6f2; font-size: 22px; }
        .tbig { background: #3c3a32; color: #f9f6f2; font-size: 18px; }
        .game-over { color: #776e65; font-size: 32px; margin-top: 20px; }
        button { margin-top: 20px; padding: 15px 30px; font-size: 18px; cursor: pointer; background: #8f7a66; color: white; border: none; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>2048</h1>
        <div class="score">Score: <span id="score">0</span></div>
        <div class="grid" id="grid"></div>
        <div class="game-over" id="gameover" style="display:none;">Game Over!</div>
        <button onclick="reset()">New Game</button>
    </div>
    <script>
        // Game state
        let board = [];
        let score = 0;
        let done = false;

        // Initialize
        function reset() {
            board = Array(4).fill().map(() => Array(4).fill(0));
            score = 0;
            done = false;
            spawnTile();
            spawnTile();
            render();
        }

        function spawnTile() {
            const empty = [];
            for (let i = 0; i < 4; i++)
                for (let j = 0; j < 4; j++)
                    if (board[i][j] === 0) empty.push([i, j]);
            if (empty.length === 0) return;
            const [r, c] = empty[Math.floor(Math.random() * empty.length)];
            board[r][c] = Math.random() < 0.1 ? 4 : 2;
        }

        function mergeRow(row) {
            let result = row.filter(x => x !== 0);
            let reward = 0;
            for (let i = 0; i < result.length - 1; i++) {
                if (result[i] === result[i + 1]) {
                    result[i] *= 2;
                    reward += result[i];
                    result.splice(i + 1, 1);
                }
            }
            while (result.length < 4) result.push(0);
            return [result, reward];
        }

        function rotateBoard(b, k) {
            let r = b.map(row => [...row]);
            for (let i = 0; i < k; i++) {
                const n = r.length;
                const rotated = Array(n).fill().map(() => Array(n).fill(0));
                for (let x = 0; x < n; x++)
                    for (let y = 0; y < n; y++)
                        rotated[y][n - 1 - x] = r[x][y];
                r = rotated;
            }
            return r;
        }

        function move(action) {
            if (done) return;
            const oldBoard = JSON.stringify(board);
            const rotation = [1, 3, 0, 2][action]; // up, down, left, right
            let rotated = rotateBoard(board, rotation);
            let reward = 0;
            for (let i = 0; i < 4; i++) {
                const [merged, r] = mergeRow(rotated[i]);
                rotated[i] = merged;
                reward += r;
            }
            board = rotateBoard(rotated, (4 - rotation) % 4);
            if (JSON.stringify(board) !== oldBoard) {
                score += reward;
                spawnTile();
                if (!canMove()) done = true;
            }
            render();
        }

        function canMove() {
            for (let i = 0; i < 4; i++)
                for (let j = 0; j < 4; j++) {
                    if (board[i][j] === 0) return true;
                    if (j < 3 && board[i][j] === board[i][j + 1]) return true;
                    if (i < 3 && board[i][j] === board[i + 1][j]) return true;
                }
            return false;
        }

        function render() {
            document.getElementById('score').textContent = score;
            document.getElementById('gameover').style.display = done ? 'block' : 'none';
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            board.flat().forEach(v => {
                const tile = document.createElement('div');
                tile.className = 'tile ' + (v > 2048 ? 'tbig' : 't' + v);
                tile.textContent = v || '';
                grid.appendChild(tile);
            });
        }

        // Keyboard
        document.addEventListener('keydown', e => {
            const map = { ArrowUp: 0, ArrowDown: 1, ArrowLeft: 2, ArrowRight: 3, w: 0, s: 1, a: 2, d: 3 };
            if (map[e.key] !== undefined) { e.preventDefault(); move(map[e.key]); }
        });

        // Touch
        let touchStartX, touchStartY;
        document.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; touchStartY = e.touches[0].clientY; });
        document.addEventListener('touchend', e => {
            const dx = e.changedTouches[0].clientX - touchStartX;
            const dy = e.changedTouches[0].clientY - touchStartY;
            if (Math.abs(dx) < 30 && Math.abs(dy) < 30) return;
            if (Math.abs(dx) > Math.abs(dy)) move(dx > 0 ? 3 : 2);
            else move(dy > 0 ? 1 : 0);
        });

        reset();
    </script>
</body>
</html>
